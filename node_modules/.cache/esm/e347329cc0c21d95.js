let express,engine,mongoose,path,ConnectModel,nodemailer;_c0c‍.w("express",[["default",["express"],function(v){express=v}]]);_c0c‍.w("express-handlebars",[["engine",["engine"],function(v){engine=v}]]);_c0c‍.w("mongoose",[["default",["mongoose"],function(v){mongoose=v}]]);_c0c‍.w("path",[["default",["path"],function(v){path=v}]]);_c0c‍.w("./Model/Contact",[["default",["ConnectModel"],function(v){ConnectModel=v}]]);_c0c‍.w("nodemailer",[["default",["nodemailer"],function(v){nodemailer=v}]]);

const app = express();





//------------------database Connection Starts here-----------------------
let mongodbURL = "mongodb://localhost:27017/students";
mongoose.connect(mongodbURL, err => {
  if (err) throw err;
  console.log("DataBase connected");
});
//------------------database Connection Ends here-----------------------

// ---------middileware block-------------------
app.use(express.static(path.join(__dirname, "public")));

//body [parser]
app.use(express.urlencoded({ extended: true }));
// ---------middleware block ends------------

app.engine("handlebars", engine());
app.set("view engine", "handlebars");
//?
app.set("views", "./views");
// basic routing
app.get("/", (req, res) => {
  res.render("home", {
    title: "Welcome to Jspiders",
    description: "Hello Students How are you",
  });
});
app.get("/contact", (req, res) => {
  res.render("contact", {
    title: "contact us",
  });
});
app.get("/assingment", (req, res) => {
  res.render("assingment", {
    title: "Assignments",
  });
});

// -------------All post request starts here
app.post("/contact", async (req, res) => {
  // save incoming request into mongodb database
  let payload = await req.body;
  //nodemailer block
  nodemailer
    .createTransport({
      service: "gmail",
      auth: {
        user: "krishguru435@gmail.com",
        pass: "Jillu@1435",
      },
    })
    .sendMail({
      from: "krishguru435@gmail.com",
      to: [req.body.email, "lifelooser007@gmail.com"],
      subject: "contact form",
      html: `<h1>${req.body.firstname}</h1>
          <h1>${req.body.lastname}</h1>
          <p>${req.body.email}</p>
           <p>${req.body.phone}</p>
            <p>${req.body.description}</p>
          `,
    });
  let data = await ConnectModel.create(payload);
  _c0c‍.g.console.log(data);
  res.send({ data, text: "Successfully created" });
});
// listen app

app.listen(5000, err => {
  if (err) throw err;
  console.log("server is running on port 5000");
});
